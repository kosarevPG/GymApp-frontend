<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gym Logger</title>
    
    <!-- Mobile Select CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mobile-select@1.0.28/dist/mobile-select.min.css">
    
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 420px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .header {
            text-align: center;
            margin-bottom: 24px;
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 8px;
        }
        
        .last-result {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
            text-align: center;
            padding: 12px;
            background: #f5f5f5;
            border-radius: 12px;
        }
        
        .picker-group {
            margin-bottom: 24px;
        }
        
        .picker-label {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
            display: block;
        }
        
        .picker-input {
            width: 100%;
            padding: 16px;
            font-size: 18px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            background: #f9f9f9;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .picker-input:active {
            background: #f0f0f0;
            border-color: #667eea;
        }
        
        .buffer-info {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
            color: #1976d2;
            font-weight: 600;
        }
        
        .sets-list {
            background: #f9f9f9;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .sets-list-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
        }
        
        .set-item {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .set-item-info {
            flex: 1;
        }
        
        .set-item-number {
            font-weight: 700;
            color: #667eea;
            margin-right: 8px;
        }
        
        .set-item-data {
            font-size: 14px;
            color: #666;
        }
        
        .set-item-delete {
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .set-item-delete:active {
            background: #cc0000;
            transform: scale(0.95);
        }
        
        .empty-sets {
            text-align: center;
            color: #999;
            font-size: 14px;
            padding: 20px;
        }
        
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .btn {
            padding: 16px 24px;
            font-size: 18px;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-secondary {
            background: #f5f5f5;
            color: #333;
        }
        
        .btn-secondary:active {
            background: #e0e0e0;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-primary:active {
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="exerciseName">–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</h1>
            <div class="last-result" id="lastResult">–ü—Ä–æ—à–ª—ã–π —Ä–∞–∑: -</div>
        </div>
        
        <div id="bufferInfo" class="buffer-info hidden">
            –í –±—É—Ñ–µ—Ä–µ: <span id="bufferCount">0</span> –ø–æ–¥—Ö–æ–¥(–æ–≤)
        </div>
        
        <div id="setsList" class="sets-list hidden">
            <div class="sets-list-title">üìã –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã:</div>
            <div id="setsListContent"></div>
        </div>
        
        <div class="picker-group">
            <label class="picker-label">–í–µ—Å (–∫–≥)</label>
            <input type="text" class="picker-input" id="weightPicker" readonly placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Å">
        </div>
        
        <div class="picker-group">
            <label class="picker-label">–ü–æ–≤—Ç–æ—Ä—ã</label>
            <input type="text" class="picker-input" id="repsPicker" readonly placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–≤—Ç–æ—Ä—ã">
        </div>
        
        <div class="picker-group">
            <label class="picker-label">–û—Ç–¥—ã—Ö</label>
            <input type="text" class="picker-input" id="restPicker" readonly placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–¥—ã—Ö">
        </div>
        
        <div class="button-group">
            <button class="btn btn-secondary" id="addToSetBtn">
                ‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤ —Å–µ—Ç (+)
            </button>
            <button class="btn btn-primary" id="saveBtn">
                üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –ø–æ–¥—Ö–æ–¥—ã –∏ –∑–∞–∫—Ä—ã—Ç—å
            </button>
        </div>
    </div>
    
    <!-- Mobile Select JS -->
    <script src="https://cdn.jsdelivr.net/npm/mobile-select@1.0.28/dist/mobile-select.min.js"></script>
    
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram?.WebApp;
        
        if (!tg) {
            console.error('‚ùå Telegram WebApp SDK not loaded');
            console.error('window.Telegram:', window.Telegram);
            console.error('–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ WebApp –æ—Ç–∫—Ä—ã—Ç –ù–ï —á–µ—Ä–µ–∑ Telegram!');
            alert('‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: WebApp –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç —á–µ—Ä–µ–∑ Telegram!\n\n–ï—Å–ª–∏ –≤—ã –æ—Ç–∫—Ä—ã–ª–∏ –µ–≥–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –¥–∞–Ω–Ω—ã–µ –Ω–µ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è.\n\n–ó–∞–∫—Ä–æ–π—Ç–µ —ç—Ç–æ –æ–∫–Ω–æ –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ WebApp —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –≤ –±–æ—Ç–µ.');
        } else {
            tg.ready();
            tg.expand();
            console.log('‚úÖ Telegram WebApp initialized');
            console.log('Telegram WebApp version:', tg.version);
            console.log('Telegram WebApp platform:', tg.platform);
            console.log('Telegram WebApp initData:', tg.initData ? 'present' : 'missing');
            console.log('Telegram WebApp initDataUnsafe:', tg.initDataUnsafe ? 'present' : 'missing');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤ Telegram
            if (!tg.initData && !tg.initDataUnsafe) {
                console.warn('‚ö†Ô∏è WebApp –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç –Ω–µ —á–µ—Ä–µ–∑ Telegram!');
            }
        }
        
        // –ü–∞—Ä—Å–∏–Ω–≥ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        const urlParams = new URLSearchParams(window.location.search);
        const exerciseName = decodeURIComponent(urlParams.get('ex') || '–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ');
        const lastWeight = parseFloat(urlParams.get('w') || '0');
        const lastReps = parseInt(urlParams.get('r') || '0');
        
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        document.getElementById('exerciseName').textContent = exerciseName;
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        const lastResultEl = document.getElementById('lastResult');
        if (lastWeight > 0 || lastReps > 0) {
            lastResultEl.textContent = `–ü—Ä–æ—à–ª—ã–π —Ä–∞–∑: ${lastWeight}–∫–≥ √ó ${lastReps}`;
        } else {
            lastResultEl.textContent = '–ü–µ—Ä–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞';
        }
        
        // –ë—É—Ñ–µ—Ä –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤
        let workoutBuffer = [];
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –≤–µ—Å–∞ (—à–∞–≥ 1.25 –∏–ª–∏ 2.5, –¥–∏–∞–ø–∞–∑–æ–Ω 0-300)
        function generateWeightValues() {
            const values = [];
            for (let i = 0; i <= 300; i += 1.25) {
                // –û–∫—Ä—É–≥–ª—è–µ–º –¥–æ 2 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
                const rounded = Math.round(i * 100) / 100;
                values.push(rounded.toFixed(2));
            }
            return values;
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –ø–æ–≤—Ç–æ—Ä–æ–≤ (1-100)
        function generateRepsValues() {
            return Array.from({length: 100}, (_, i) => String(i + 1));
        }
        
        // –ó–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –æ—Ç–¥—ã—Ö–∞ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
        const restValues = [
            {label: '0 —Å–µ–∫', value: 0},
            {label: '30 —Å–µ–∫', value: 30},
            {label: '60 —Å–µ–∫', value: 60},
            {label: '90 —Å–µ–∫', value: 90},
            {label: '2 –º–∏–Ω', value: 120},
            {label: '2.5 –º–∏–Ω', value: 150},
            {label: '3 –º–∏–Ω', value: 180},
            {label: '3.5 –º–∏–Ω', value: 210},
            {label: '4 –º–∏–Ω', value: 240},
            {label: '4.5 –º–∏–Ω', value: 270},
            {label: '5 –º–∏–Ω', value: 300}
        ];
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞—Ä–∞–±–∞–Ω–æ–≤ (pickers)
        let weightSelect, repsSelect, restSelect;
        
        // –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞—Ä–∞–±–∞–Ω–æ–≤
        function initPickers() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ MobileSelect
            if (typeof MobileSelect === 'undefined') {
                console.warn('MobileSelect library not loaded, using fallback inputs');
                // Fallback: –¥–µ–ª–∞–µ–º –ø–æ–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–º–∏
                document.getElementById('weightPicker').removeAttribute('readonly');
                document.getElementById('weightPicker').type = 'number';
                document.getElementById('weightPicker').step = '0.25';
                document.getElementById('weightPicker').min = '0';
                document.getElementById('weightPicker').max = '300';
                document.getElementById('weightPicker').placeholder = '–í–≤–µ–¥–∏—Ç–µ –≤–µ—Å (–∫–≥)';
                
                document.getElementById('repsPicker').removeAttribute('readonly');
                document.getElementById('repsPicker').type = 'number';
                document.getElementById('repsPicker').min = '1';
                document.getElementById('repsPicker').max = '100';
                document.getElementById('repsPicker').placeholder = '–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–æ–≤';
                
                document.getElementById('restPicker').removeAttribute('readonly');
                document.getElementById('restPicker').type = 'number';
                document.getElementById('restPicker').min = '0';
                document.getElementById('restPicker').max = '600';
                document.getElementById('restPicker').placeholder = '–í–≤–µ–¥–∏—Ç–µ –æ—Ç–¥—ã—Ö (—Å–µ–∫)';
                return;
            }
            
            try {
                // –ë–∞—Ä–∞–±–∞–Ω –¥–ª—è –≤–µ—Å–∞
                weightSelect = new MobileSelect({
                    trigger: '#weightPicker',
                    title: '–í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Å',
                    wheels: [{
                        data: generateWeightValues()
                    }],
                    initValue: lastWeight > 0 ? lastWeight.toFixed(2) : '0.00',
                    callback: function(indexArr, data) {
                        document.getElementById('weightPicker').value = data[0] + ' –∫–≥';
                    }
                });
                
                // –ë–∞—Ä–∞–±–∞–Ω –¥–ª—è –ø–æ–≤—Ç–æ—Ä–æ–≤
                repsSelect = new MobileSelect({
                    trigger: '#repsPicker',
                    title: '–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–≤—Ç–æ—Ä—ã',
                    wheels: [{
                        data: generateRepsValues()
                    }],
                    initValue: lastReps > 0 ? String(lastReps) : '1',
                    callback: function(indexArr, data) {
                        document.getElementById('repsPicker').value = data[0] + ' —Ä–∞–∑';
                    }
                });
                
                // –ë–∞—Ä–∞–±–∞–Ω –¥–ª—è –æ—Ç–¥—ã—Ö–∞
                restSelect = new MobileSelect({
                    trigger: '#restPicker',
                    title: '–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–¥—ã—Ö',
                    wheels: [{
                        data: restValues.map(item => item.label)
                    }],
                    initValue: 0,
                    callback: function(indexArr, data) {
                        document.getElementById('restPicker').value = data[0];
                    }
                });
                
                console.log('Pickers initialized successfully');
            } catch (error) {
                console.error('Error initializing pickers:', error);
                // Fallback: –¥–µ–ª–∞–µ–º –ø–æ–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–º–∏
                document.getElementById('weightPicker').removeAttribute('readonly');
                document.getElementById('weightPicker').type = 'number';
                document.getElementById('repsPicker').removeAttribute('readonly');
                document.getElementById('repsPicker').type = 'number';
                document.getElementById('restPicker').removeAttribute('readonly');
                document.getElementById('restPicker').type = 'number';
            }
        }
        
        // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ DOM
        if (typeof MobileSelect !== 'undefined') {
            // –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initPickers);
            } else {
                initPickers();
            }
        } else {
            // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
            window.addEventListener('load', function() {
                setTimeout(initPickers, 100); // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏
            });
        }
        
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (–ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏)
        setTimeout(function() {
            const weightInput = document.getElementById('weightPicker');
            const repsInput = document.getElementById('repsPicker');
            const restInput = document.getElementById('restPicker');
            
            if (weightInput.type === 'number') {
                // Fallback —Ä–µ–∂–∏–º
                weightInput.value = lastWeight > 0 ? lastWeight : '';
                repsInput.value = lastReps > 0 ? lastReps : '';
                restInput.value = '60';
            } else {
                // –†–µ–∂–∏–º —Å –±–∞—Ä–∞–±–∞–Ω–∞–º–∏
                if (lastWeight > 0) {
                    weightInput.value = lastWeight.toFixed(2) + ' –∫–≥';
                }
                if (lastReps > 0) {
                    repsInput.value = lastReps + ' —Ä–∞–∑';
                }
                restInput.value = '60 —Å–µ–∫';
            }
        }, 200);
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π
        function getCurrentValues() {
            const weightInput = document.getElementById('weightPicker');
            const repsInput = document.getElementById('repsPicker');
            const restInput = document.getElementById('restPicker');
            
            let weight, reps, rest;
            
            if (weightInput.type === 'number') {
                // Fallback —Ä–µ–∂–∏–º - –æ–±—ã—á–Ω—ã–µ number inputs
                weight = parseFloat(weightInput.value) || 0;
                reps = parseInt(repsInput.value) || 0;
                // –í fallback —Ä–µ–∂–∏–º–µ –æ—Ç–¥—ã—Ö –≤–≤–æ–¥–∏—Ç—Å—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö –Ω–∞–ø—Ä—è–º—É—é
                rest = parseInt(restInput.value) || 60;
            } else {
                // –†–µ–∂–∏–º —Å –±–∞—Ä–∞–±–∞–Ω–∞–º–∏
                try {
                    if (weightSelect) {
                        const weightStr = weightSelect.getValue();
                        weight = parseFloat(weightStr) || 0;
                    } else {
                        weight = parseFloat(weightInput.value.replace(' –∫–≥', '')) || 0;
                    }
                    
                    if (repsSelect) {
                        const repsStr = repsSelect.getValue();
                        reps = parseInt(repsStr) || 0;
                    } else {
                        reps = parseInt(repsInput.value.replace(' —Ä–∞–∑', '')) || 0;
                    }
                    
                    if (restSelect) {
                        const restStr = restSelect.getValue();
                        const restItem = restValues.find(item => item.label === restStr);
                        rest = restItem ? restItem.value : 60;
                    } else {
                        const restStr = restInput.value;
                        const restItem = restValues.find(item => item.label === restStr);
                        rest = restItem ? restItem.value : 60;
                    }
                } catch (error) {
                    console.error('Error getting values from pickers:', error);
                    // Fallback: —á–∏—Ç–∞–µ–º –∏–∑ input –ø–æ–ª–µ–π
                    weight = parseFloat(weightInput.value.replace(' –∫–≥', '')) || 0;
                    reps = parseInt(repsInput.value.replace(' —Ä–∞–∑', '')) || 0;
                    const restStr = restInput.value;
                    const restItem = restValues.find(item => item.label === restStr);
                    rest = restItem ? restItem.value : 60;
                }
            }
            
            return { weight, reps, rest };
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±—É—Ñ–µ—Ä–µ
        function updateBufferInfo() {
            const bufferInfoEl = document.getElementById('bufferInfo');
            const bufferCountEl = document.getElementById('bufferCount');
            const setsListEl = document.getElementById('setsList');
            const setsListContentEl = document.getElementById('setsListContent');
            
            if (workoutBuffer.length > 0) {
                bufferInfoEl.classList.remove('hidden');
                bufferCountEl.textContent = workoutBuffer.length;
                setsListEl.classList.remove('hidden');
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–¥—Ö–æ–¥–æ–≤
                setsListContentEl.innerHTML = '';
                workoutBuffer.forEach((set, index) => {
                    const setItem = document.createElement('div');
                    setItem.className = 'set-item';
                    setItem.innerHTML = `
                        <div class="set-item-info">
                            <span class="set-item-number">–ü–æ–¥—Ö–æ–¥ ${index + 1}:</span>
                            <span class="set-item-data">${set.weight}–∫–≥ √ó ${set.reps} (–æ—Ç–¥—ã—Ö: ${set.rest}—Å)</span>
                        </div>
                        <button class="set-item-delete" onclick="removeSet(${index})">‚úï</button>
                    `;
                    setsListContentEl.appendChild(setItem);
                });
            } else {
                bufferInfoEl.classList.add('hidden');
                setsListEl.classList.add('hidden');
                setsListContentEl.innerHTML = '<div class="empty-sets">–ù–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤</div>';
            }
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–∞ –∏–∑ –±—É—Ñ–µ—Ä–∞
        function removeSet(index) {
            workoutBuffer.splice(index, 1);
            updateBufferInfo();
        }
        
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ
        window.removeSet = removeSet;
        
        // –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –≤ —Å–µ—Ç"
        document.getElementById('addToSetBtn').addEventListener('click', function() {
            const current = getCurrentValues();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–Ω—ã
            if (current.weight === 0 && current.reps === 0) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–µ—Å –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–æ–≤');
                return;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥—Ö–æ–¥ –≤ –±—É—Ñ–µ—Ä
            workoutBuffer.push({
                exercise: exerciseName,
                weight: current.weight,
                reps: current.reps,
                rest: current.rest
            });
            
            updateBufferInfo();
            
            // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
            const originalText = this.textContent;
            this.textContent = '‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ!';
            setTimeout(() => {
                this.textContent = originalText;
            }, 1000);
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Å–ø–∏—Å–∫—É –ø–æ–¥—Ö–æ–¥–æ–≤
            document.getElementById('setsList').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        });
        
        // –ö–Ω–æ–ø–∫–∞ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"
        document.getElementById('saveBtn').addEventListener('click', async function() {
            try {
                console.log('=== –ù–ê–ß–ê–õ–û –°–û–•–†–ê–ù–ï–ù–ò–Ø ===');
                // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –±—É—Ñ–µ—Ä, –µ—Å–ª–∏ –æ–Ω–∏ –µ—â–µ –Ω–µ —Ç–∞–º
                const current = getCurrentValues();
                
                console.log('Current values:', current);
                console.log('Exercise name:', exerciseName);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–Ω—ã
                if (current.weight === 0 && current.reps === 0) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–µ—Å –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–æ–≤');
                    return;
                }
                
                const currentExists = workoutBuffer.some(item => 
                    item.exercise === exerciseName &&
                    item.weight === current.weight &&
                    item.reps === current.reps &&
                    item.rest === current.rest
                );
                
                if (!currentExists) {
                    workoutBuffer.push({
                        exercise: exerciseName,
                        weight: current.weight,
                        reps: current.reps,
                        rest: current.rest
                    });
                }
                
                // –ï—Å–ª–∏ –±—É—Ñ–µ—Ä –ø—É—Å—Ç, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏ –¥–æ–±–∞–≤–ª—è–µ–º
                if (workoutBuffer.length === 0) {
                    if (current.weight === 0 && current.reps === 0) {
                        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –¥–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø–æ–¥—Ö–æ–¥ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ');
                        return;
                    }
                    workoutBuffer.push({
                        exercise: exerciseName,
                        weight: current.weight,
                        reps: current.reps,
                        rest: current.rest
                    });
                }
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º –∏—Ç–æ–≥–æ–≤—ã–π JSON
                const finalData = {
                    type: "workout_data",
                    payload: workoutBuffer
                };
                
                console.log('Sending data:', finalData);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ Telegram WebApp SDK –¥–æ—Å—Ç—É–ø–µ–Ω
                if (!tg) {
                    console.error('Telegram WebApp SDK not available');
                    alert('–û—à–∏–±–∫–∞: Telegram WebApp SDK –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
                    return;
                }
                
                if (!tg.sendData) {
                    console.error('tg.sendData is not available');
                    console.log('Available tg methods:', Object.keys(tg));
                    alert('–û—à–∏–±–∫–∞: –º–µ—Ç–æ–¥ sendData –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
                    return;
                }
                
                const dataString = JSON.stringify(finalData);
                console.log('Sending data string:', dataString);
                console.log('Data length:', dataString.length);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
                const setsCount = workoutBuffer.length;
                console.log(`–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ${setsCount} –ø–æ–¥—Ö–æ–¥–æ–≤...`);
                
                try {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ Telegram
                    console.log('=== –ü–†–û–í–ï–†–ö–ê TELEGRAM WEBAPP ===');
                    console.log('tg –æ–±—ä–µ–∫—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:', !!tg);
                    console.log('tg.version:', tg?.version);
                    console.log('tg.platform:', tg?.platform);
                    console.log('tg.isExpanded:', tg?.isExpanded);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å sendData
                    if (!tg || typeof tg.sendData !== 'function') {
                        console.error('‚ùå tg.sendData –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω!');
                        console.log('–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã:', Object.keys(tg || {}));
                        alert('–û—à–∏–±–∫–∞: Telegram WebApp SDK –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ WebApp –æ—Ç–∫—Ä—ã—Ç —á–µ—Ä–µ–∑ Telegram.');
                        return;
                    }
                    
                    console.log('‚úÖ tg.sendData –¥–æ—Å—Ç—É–ø–µ–Ω');
                    console.log('–î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏:', dataString);
                    console.log('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥—Ö–æ–¥–æ–≤:', workoutBuffer.length);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤ Telegram
                    if (!tg.initData || !tg.initDataUnsafe) {
                        console.warn('‚ö†Ô∏è WebApp –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç –Ω–µ —á–µ—Ä–µ–∑ Telegram!');
                        alert('‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ: WebApp –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç —á–µ—Ä–µ–∑ Telegram. –ï—Å–ª–∏ –≤—ã –æ—Ç–∫—Ä—ã–ª–∏ –µ–≥–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –¥–∞–Ω–Ω—ã–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤—è—Ç—Å—è.');
                    }
                    
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –±–æ—Ç
                    console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ tg.sendData()...');
                    console.log('–î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ (—Å—Ç—Ä–æ–∫–∞):', dataString);
                    console.log('–î–ª–∏–Ω–∞ –¥–∞–Ω–Ω—ã—Ö:', dataString.length);
                    console.log('–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö:', typeof dataString);
                    
                    try {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø—É—Å—Ç—ã–µ
                        if (!dataString || dataString.length === 0) {
                            throw new Error('–î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—É—Å—Ç—ã–µ!');
                        }
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞
                        if (typeof dataString !== 'string') {
                            console.warn('‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –Ω–µ —Å—Ç—Ä–æ–∫–∞, –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º...');
                            dataString = String(dataString);
                        }
                        
                        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                        console.log('–í—ã–∑–æ–≤ tg.sendData() —Å –¥–∞–Ω–Ω—ã–º–∏:', dataString.substring(0, 100) + '...');
                        tg.sendData(dataString);
                        console.log('‚úÖ tg.sendData() –≤—ã–∑–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ');
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã
                        const setsCount = workoutBuffer.length;
                        const alertMessage = `‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ${setsCount} –ø–æ–¥—Ö–æ–¥–æ–≤!\n\n–î–∞–Ω–Ω—ã–µ: ${dataString.substring(0, 50)}...\n\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –±–æ—Ç–∞.`;
                        alert(alertMessage);
                        console.log('Alert –ø–æ–∫–∞–∑–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é');
                        
                        // –ñ–¥–µ–º –¥–æ–ª—å—à–µ, —á—Ç–æ–±—ã –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ–ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è
                        console.log('–û–∂–∏–¥–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö (3 —Å–µ–∫—É–Ω–¥—ã)...');
                        await new Promise(resolve => setTimeout(resolve, 3000));
                        console.log('–ó–∞–¥–µ—Ä–∂–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –∑–∞–∫—Ä—ã–≤–∞–µ–º WebApp...');
                        
                        // –ó–∞–∫—Ä—ã–≤–∞–µ–º WebApp
                        if (tg.close) {
                            tg.close();
                            console.log('‚úÖ WebApp –∑–∞–∫—Ä—ã—Ç');
                        } else {
                            console.warn('‚ö†Ô∏è tg.close() –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
                        }
                    } catch (sendError) {
                        console.error('‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ø—Ä–∏ –≤—ã–∑–æ–≤–µ tg.sendData():', sendError);
                        console.error('–¢–∏–ø –æ—à–∏–±–∫–∏:', typeof sendError);
                        console.error('–°–æ–æ–±—â–µ–Ω–∏–µ –æ—à–∏–±–∫–∏:', sendError.message);
                        console.error('–°—Ç–µ–∫ –æ—à–∏–±–∫–∏:', sendError.stack);
                        alert('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ' + sendError.message + '\n\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.');
                        throw sendError;
                    }
                } catch (error) {
                    console.error('‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê:', error);
                    console.error('–°—Ç–µ–∫:', error.stack);
                    alert('–û—à–∏–±–∫–∞: ' + error.message + '\n\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.');
                    // –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º WebApp –ø—Ä–∏ –æ—à–∏–±–∫–µ
                }
                
            } catch (error) {
                console.error('‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏:', error);
                console.error('–°—Ç–µ–∫ –æ—à–∏–±–∫–∏:', error.stack);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: ' + error.message);
            } finally {
                console.log('=== –ö–û–ù–ï–¶ –°–û–•–†–ê–ù–ï–ù–ò–Ø ===');
            }
        });
    </script>
</body>
</html>

